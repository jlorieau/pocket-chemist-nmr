version: '3'

vars:
  PULPROG:
    sh: grep PULPROG\= acqus|sed 's/.*<//g'|sed 's/>//g'

tasks:
  build:
    deps: [convert, process, process-complex]

  convert:
    cmds:
      - "bruk2pipe -verb -in ./fid \
           -bad 0.0 -ext -aswap -AMX -decim 2000 -dspfvs 20 -grpdly 67.9862518310547  \
           -xN              1792  \
           -xT               799  \
           -xMODE            DQD  \
           -xSW        10000.000  \
           -xOBS         499.872  \
           -xCAR           4.773  \
           -xLAB              1H  \
           -ndim               1  \
         | nmrPipe -fn MULT -c 2.44141e-01 \
           -out ./spec.fid -ov"
    sources:
      - "fid"
    generates:
      - "spec.fid"

  process:
    deps: [convert,]
    cmds:
      - "nmrPipe -in spec.fid \
         | nmrPipe  -fn SP -off 0.45 -end 0.95 -pow 1 -c 0.5 \
         | nmrPipe -fn ZF -size 8192 \
         | nmrPipe -fn FT -auto \
         | nmrPipe -fn PS -p0 0. -p1 0. -di \
          -ov -out {{.PULPROG}}.ft"
    sources:
      - "spec.fid"
    generates:
      - "{{.PULPROG}}.ft"

  process-complex:
    deps: [convert,]
    cmds:
      - "nmrPipe -in spec.fid \
         | nmrPipe  -fn SP -off 0.45 -end 0.95 -pow 1 -c 0.5 \
         | nmrPipe -fn ZF -size 8192 \
         | nmrPipe -fn FT -auto \
         | nmrPipe -fn PS -p0 0. -p1 0. \
          -ov -out {{.PULPROG}}_complex.ft"
    sources:
      - "spec.fid"
    generates:
      - "{{.PULPROG}}_complex.ft"
